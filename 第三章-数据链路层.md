# 数据链路层

数据链路层使用的信道主要有以下两种类型：

* 点对点信道
* 广播信道

## 使用点对点信道的数据链路层

### 数据链路和帧

链路是一条无源的点到点的物理线路段，中间没有任何其他交换节点。

数据链路除了物理线路外，还必须有通信协议来控制这些数据的传输，若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。

现在最常用的方法就是使用适配器（即网卡）来实现这些硬件和软件。

也有人把链路分为物理链路和逻辑链路，

物理线路就是上面所说的链路，逻辑链路就是上面所说的数据链路，是物理链路加上必要的通信协议。

数据链路层传送的是帧，

### 三个基本问题

1. 封装成帧

   封装成帧就是在一段数据前后分别添加首部和尾部，然后就构成了一个帧确定帧的界限首部和尾部的一个重要作用就是帧定界。

   帧：数据链路层按照具体协议要修比特流装配而成的。

   帧同步是为了使接收方能够从收到的比特流中准确的去别处一帧的开始和结束。

   实现帧同步的方法：

   * 字节计数法：

   * 字符填充法：

   * 比特填充法：

   * 违法编码法：

     曼彻斯特编码和查分曼彻斯特编码属于违法编码法

2. 透明传输

   如果数据中耨个字节的二进制代码恰好和SOH或EOT一样，数据链路层就会错误的找到帧的边界。

   解决的办法：字节填充，发送端在数据链路层在数据中出现控制字符SOH或EOT的前面加上转义字符ESC

3. 差错控制

   1变成0或0变成1。

   差错控制是数据链路层的主要功能之一，但不是数据链路层所特有的功能。在网络层和传输层也都有差错控制功能，只是差错控制对此昂不同。

   在数据链路层传送的帧中，广泛采用的`循环冗余检验，CRC`的检错技术。

   这种检测方法不能确定究竟是哪一个或那几个比特出现了错误。

   要做到可靠传输，就必须加上确认和重传机制。

   `本章介绍的数据链路层协议都是不可靠传输协议`

流量控制：流量控制也不是数据链路层所特有的功能，在其他高层协议中也有流量控制功能

寻址：在点对点式的链路上不存在寻址问题，在多点连接的情况下，必须保证每帧能正确地传送到接受方，而接受方也应该知道发送方的地址。

常用的差错控制方法采用：`自动重发请求，ARQ`技术和`前向纠错技术，FEC`

常用的流量控制方法采用：停等协议和滑动窗口协议。

* 停等协议

  停等协议是最基本最简单的流量控制协议。在源和目标之间的数据流动是由接受方来控制的。

* 滑动窗口

  允许连续发送多个为被确认的帧。

差错控制是检测和纠正错误的机制，通常应付传输差错的办法如下：

* 肯定应答
* 否定应答重发
* 超时重发

这些技术的主要思想就是利用差错检测技术自动对丢失的帧和错误帧请求重发，称之为`自动请求重发，ARQ`，结合流控技术，可以组成三种形式的ARQ协议：

* 停等ARQ

  停等ARQ协议是停等留空技术和自动请求重发合计技术的结合

* 后退N帧ARQ

  是滑动窗口技术和自动请求重发技术的结合

* 选择重发ARQ

  是滑动窗口技术和自动请求重发技术的结合，设置接收窗口像发送窗口一样大，允许将未按顺序到达的数据帧暂存，只是选择性的重发出错或丢失的帧。

差错控制技术：

* 概括地说，传输中的差错都是由噪声所引起的。
* 噪声有两大类，一类是信道所固有的持续存在的随即热噪声，另一类是外界特定的短暂原因造成的冲击噪声。
* 衡量信道质量的一个重要的参数是误码率

奇偶效验码：通过增加冗余位来使得码字中1的个数保持奇数偶数的编码方法。是一种验错码。

* 使用时分为
  * 垂直奇偶效验
  * 水平奇偶效验
  * 水平垂直奇偶效验

`CRC码：称为多项式码，循环冗余效验码`能够检测出数据帧的1位或n位错误，然后丢弃重传，具有良好的检错能力。

在数据后面添加的冗余码称为`帧检验序列，FCS`

FCS和CRC并不等同，CRC是一种常用的检错方法，而FCS是添加在数据后面的冗余码。

HDLC链路结构和操作方式：

HDLC定义了三种类型的站，两种链路配置和三种传输方式。

三种类型站为：

* 主站
* 次站
* 复合站

两种链路配置：

* 非平衡配置
* 平衡配置

三种数据传输方式：

* 正常响应方式
* 异步响应方式
* 异步平衡方式

![PSUi1U.png](https://s1.ax1x.com/2018/06/21/PSUi1U.png)

* 标志字段：

  HDLC用一种特殊的位模式01111110作为标志以确定帧的边界

* 地址字段：

  用于标识从站的地址，用在点对多的链路中，地址通常是8位，也可以采用更长的扩展地址，是8位的整数倍。8位组的第一位表示是否是地址字段的结尾。其余7位组成了扩展地址字段。全为1的8位组表示广播地址。

* HDLC定义了三种帧，信息帧，管理帧，无编号帧。

  * 信息帧（I帧）

    用于实现信息的编号传送，控制字段第一位为0，它具有发送序号N(S)，用于表明所发送的信息帧的序号。只有信息帧才拥有此序号，还有捎带的肯定应答信号N(R)，用于标明预期接收的帧的序号。

  * 管理帧（S帧）

    用于实现流量控制和差错控制，控制字段的前两位为10，只含有接收序号，不包含信息段。

  * 无编号帧（U帧）

    用于链路的控制。

* 信息字段（INFO）

  只有I帧和某些无编号帧含有信息字段，这个字段可含有表示用户数据的任何比特序列，其长度没有规定，但具体的实现往往限定了最大帧长。

* 帧效验序列（FCS）

  FCS中含有除标志字段之外的所有其他字段的效验和。

HDLC帧的类型：

* 信息帧

  信息帧用来承载用户数据外，还包含帧的编号，以及捎带的肯定应答序号。

* 管理帧

* 无编号帧



## 点对点协议PPP

## 使用广播信道的数据链路层

## 扩展的以太网

## 高速以太网

